# Каталог книг

## Bookshelf.Backend

Платформа: ASP.NET Core NET 7.0

## Краткое описание

Курсовой демонстрационный проект Bookshelf, представляет собой "интернет-магазин" книг.

## Из чего состоит проект

В реализации будут использоваться следующие технологии, сборки, фреймворки, подходы, паттерны:

- Clean Architecture
- Mediatr + CQRS
- База данных Sqlite
- EntityFrameworkCore
- FluentValidation
- AutoMapper
- Microsoft Identity
- Swagger

# Требования, правила, бизнес-логика

## Роли в системе

В проекте используется две роли, которые регламентируют доступ к функционалу.
`Administrator` - главная роль, дает пользователю возможность выполнять любые операции с любыми объектами.
`User` - позволяет пользователю добавлять отзывы к книгам.

Незарегистрированные пользователи работают с системой в режиме "readonly".

## Сущность "Author"

- [x] При создании, по умолчанию скрыт.
- [x] `FirstName` должно быть не менее 2 и не более 50 символов.
- [x] `LastName` должно быть не менее 2 и не более 50 символов.
- [x] `Author` можно создать без книг.
- [x] `Author` можно включить/выключить (скрыть/показать для всеобщего просмотра).
- [x] При включении автора, необходимо явно указать, включать или не включать книги.
- [x] При выключении автора, все книги автора тоже должны быть выключенны.
- [x] При получение всех авторов `GetAll()` администратор должен получать и скрытых авторов тоже.
- [x] API должна содержать методы CRUD для управления сущностью `Author`:
  - [x] `GetAll()`
  - [x] `Get(Guid id)`
  - [x] `Create(CreateAuthorDto createAuthorDto)`
  - [x] `Update(UpdateAuthorDto updateAuthorDto)`
  - [x] `Delete(Guid id)`

---

## Сущность "Genre"

- [x] При создании, по умолчанию скрыт.
- [x] `Name` должно быть не менее 5 и не более 50 символов.
- [x] `Description` должно быть не более 1024 символов, но может быть пустым.
- [x] `Genre` можно создать без книг.
- [x] `Genre` можно включить/выключить (скрыть/показать для всеобщего просмотра).
- [x] При получение всех жанров `GetAll()` администратор должен получать и скрытые жанры тоже.
- [x] API должна содержать методы CRUD для управления сущностью `Genre`:
  - [x] `GetAll()`
  - [x] `Get(Guid id)`
  - [x] `Create(CreateGenreDto createGenreDto)`
  - [x] `Update(UpdateGenreDto updateGenreDto)`
  - [x] `Delete(Guid id)`

---

## Сущность "Book"

- [x] При создании, по умолчанию скрыта.
- [x] `Title` должно быть не менее 5 и не более 128 символов.
- [x] `Description` должно быть не более 2048 символов, но может быть пустым.
- [x] `Price` должна быть больше 0.
- [x] `GenreIds` обязательно при создании новой книги.
- [x] `Visible` можно включить/выключить (скрыть/показать для всеобщего просмотра).
- [x] `Visible` нельзя включить, если автор книги выключен.
- [x] `Visible` нельзя включить, если все жанры книги скрыты.
- [x] При получении всех книг, необходимо использовать разбиение на страницы (paging).
- [x] API должна содержать методы CRUD для управления сущностью `Book`:
  - [ ] `GetPaged(int pageIndex, int pageSize)`
  - [x] `GetAll()` (не рекомендуется)
  - [x] `Get(Guid id)`
  - [x] `Create(CreateBookDto createBookDto)`
  - [x] `Update(UpdateBookDto updateBookDto)`
  - [x] `Delete(Guid id)`
  - [x] `AddBookGenre(Guid bookId, Guid GenreId)`
  - [x] `DeleteBookGenre(Guid bookId, Guid genreId)`

---

## Сущность "Review"

- [x] `UserName` должно быть не менее 5 и не более 128 символов.
- [x] `Comment` должен быть не более 2048 символов, но может быть пустым.
- [x] `Rating` должен быть от 1 до 5 единиц.
- [x] `BookId` обязательно при создании нового обзора (комментария)
- [x] `Visible` можно включить/выключить (скрыть/показать для всеобщего просмотра).
- [ ] При получении всех отзывов, необходимо использовать разбиение на страницы (paging).
- [x] API должна содержать методы CRUD для управления сущностью `Review`:
  - [ ] `GetPaged(int pageIndex, int pageSize)`
  - [x] `GetAll(Guid bookId)`
  - [x] `Get(Guid id)`
  - [x] `Create(CreateReviewDto createReviewDto)`
  - [x] `Update(UpdateReviewDto updateReviewDto)`
  - [x] `Delete(Guid id)`
  - [ ] `GetLastReview(int count)`

---

## Общие требования для сущности Review

- [x] Книга может иметь несколько отзывов или не иметь вообще.
- [x] Отзыв может оставить только зарегистрированный пользователь (`User`).
- [x] Отзыв должен содержать следующие обязательные свойства: `Id`, `Comment`, `Rating`, `UserName`
- [ ] Список последних 10 отзывов может быть также запрошен на UI (см. `GetLastReview(int count)`).
- [x] При сокрытии книги от всеобщего просмотра, отзывы о книге тоже должны быть скрыты.

---

## Требования для роли Администратор

- [x] Администратор должен иметь возможность создавать/обновлять/удалять сущности

---

## Требования для роли Пользователь

- [x] Пользователь может удалить только свой отзыв.
- [x] Пользователь может добавить сколько угодно отзывов на любую книгу.
- [x] Пользователь может изменить рейтинг своего отзыва и текст содержания.
